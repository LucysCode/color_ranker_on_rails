<h1 style="text-align:center">Welcome to Color Ranker where you can rank ugly colors!</h1>
<h2 style="text-align:center">Is this color ugly?</h2>
<p style="text-align:center">Select up to <%= @max_colors %> ugly colors and <%= @max_colors %> great colors!</p>

<!-- Middle: Ugly | Color Box | Nice -->
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-top: 30px; gap: 30px;">

  <!-- Left Column: Ugly Colors -->
  <div style="flex: 1;">
    <% if @ugly_colors.present? %>
      <h3 style="text-align:center;">Top Ugly Colors</h3>
      <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
        <% @ugly_colors.each do |color| %>
          <div style="width: 60px; height: 60px; background-color: <%= color %>; border: 1px solid #000;"></div>
        <% end %>
      </div>
    <% end %>  
  </div>

  <!-- Center Column: Color Box and Buttons -->
  <div style="flex: 1; text-align:center;">

    <% unless @show_pikachu %>
      <div class="color-box" style="width: 300px; height: 193px; background-color: <%= @hex_color %>; border: 2px solid #000; margin: 0 auto;"></div>
    <% end %>

    <% if @show_pikachu %>
      <div style="text-align: center; margin-bottom: 10px;">
        <img src="<%= @image_url %>" alt="Surprised Pikachu" style="max-width: 300px; height: auto;" />
        <br>
        <small style="font-size: 6px;">
          Image from
          <a href="https://knowyourmeme.com/memes/surprised-pikachu" target="_blank" rel="noopener noreferrer">
            Know Your Meme
          </a>
        </small>
        <p style="text-align:center; margin-top: 10px;">Pikachu: I&rsquo;m surprised</p>
      </div>
    <% end %>

    <% unless @show_pikachu %>
      <p style="text-align:center; margin-top: 10px;">Color Code: <%= @hex_color %></p>
    <% end %>

    <div style="text-align:center; margin-top: 10px;">
      <button onclick="submitVote('ugly')">Ew, it&rsquo;s ugly</button>
      <button onclick="submitVote('nice')">Great color</button>
    </div>

    <div style="text-align:center; margin-top: 10px;">
      <form method="get" action="/">
        <input type="hidden" name="new_color" value="true">
        <button type="submit">Not sure, give me a new color</button>
      </form>
    </div>

    <div style="text-align:center; margin-top: 10px;">
      <form method="post" action="/reset">
        <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
        <button type="submit">Reset</button>
      </form>
    </div>

    <% if @message %>
      <p style="color: red; text-align:center; margin-top: 10px;"><%= @message %></p>
    <% end %>

    <% if flash[:notice] %>
      <p style="color: red; text-align:center; margin-top: 10px;"><%= flash[:notice] %></p>
    <% end %>

  </div>

  <!-- Right Column: Nice Colors -->
  <div style="flex: 1;">
    <% if @nice_colors.present? %>
      <h3 style="text-align:center;">Top Nice Colors</h3>
      <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
        <% @nice_colors.each do |color| %>
          <div style="width: 60px; height: 60px; background-color: <%= color %>; border: 1px solid #000;"></div>
        <% end %>
      </div>
    <% end %>
  </div>

</div>

<script>
  function submitVote(vote) {
    fetch('/vote', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': '<%= form_authenticity_token %>'
      },
      body: JSON.stringify({ vote: vote })
    }).then(response => {
      if (response.ok) {
        window.location.href = "/?new_color=true";
      } else {
        alert("Failed to submit vote.");
      }
    });
  }
</script>
